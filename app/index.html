<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fold - Privacy-Preserving DeFi Security</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fold: {
              bg: '#0b0e14',
              card: 'rgba(255,255,255,0.05)',
              cyan: '#00EAFF',
              blue: '#2BAEDA',
              yellow: '#FBFB99',
              pink: '#FF3E8F',
            }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
      background: #0b0e14;
      color: #fff;
    }
    .mono { font-family: 'SF Mono', 'JetBrains Mono', monospace; }

    /* Cards */
    .fold-card {
      background: rgba(255,255,255,0.05);
      border-radius: 24px;
      overflow: hidden;
      position: relative;
    }
    .fold-card-glow::after {
      content: '';
      position: absolute;
      top: 94px;
      left: 50%;
      transform: translateX(-50%);
      width: 343px;
      height: 109px;
      background: radial-gradient(ellipse 171px 54px at center, rgba(136,212,255,0.15) 0%, transparent 100%);
      pointer-events: none;
    }

    /* Shield card with gradient glow */
    .shield-card {
      background: rgba(255,255,255,0.01);
      border-radius: 24px;
      overflow: hidden;
      position: relative;
    }

    /* Badges */
    .badge-healthy {
      display: inline-flex; align-items: center; justify-content: center;
      background: rgba(43,174,218,0.1); color: #00EAFF;
      font-size: 12px; font-weight: 500;
      padding: 12px; border-radius: 6px;
    }
    .badge-caution {
      display: inline-flex; align-items: center; justify-content: center;
      background: rgba(251,251,153,0.1); color: #FBFB99;
      font-size: 12px; font-weight: 500;
      padding: 12px; border-radius: 6px;
    }
    .badge-risk {
      display: inline-flex; align-items: center; justify-content: center;
      background: rgba(255,62,143,0.1); color: #FF3E8F;
      font-size: 12px; font-weight: 500;
      padding: 12px; border-radius: 6px;
    }

    /* Filter pills */
    .filter-pill {
      padding: 12px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 500;
      background: rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: all 0.15s;
      border: none;
    }
    .filter-pill.active {
      background: rgba(255,255,255,0.2);
      color: #fff;
    }

    /* Position rows */
    .position-row { transition: background 0.15s; border-radius: 12px; }
    .position-row:hover { background: rgba(255,255,255,0.03); }

    /* Action buttons */
    .action-btn {
      width: 40px; height: 40px;
      border-radius: 12px;
      display: inline-flex; align-items: center; justify-content: center;
      color: rgba(255,255,255,0.7);
      transition: all 0.15s;
      cursor: pointer; border: none; background: none;
      padding: 8px;
    }
    .action-btn:hover { background: rgba(255,255,255,0.05); }

    /* Health bars */
    .health-bar {
      border-radius: 50px;
      width: 10px;
      flex-shrink: 0;
    }
    .health-bar.healthy { background: rgba(43,174,218,0.4); }
    .health-bar.caution { background: rgba(251,251,153,0.7); }
    .health-bar.risk { background: rgba(255,0,106,0.7); }

    /* Footer bar */
    .footer-bar {
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      background: rgba(255,255,255,0.02);
      border-radius: 42px 42px 0 0;
    }

    /* Protocol icons */
    .protocol-icon {
      width: 32px; height: 32px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      border: 2.5px solid;
      overflow: hidden;
    }
    .protocol-icon.kamino { background: #04182f; border-color: #caf2fc; }
    .protocol-icon.marginfi { background: #0f1110; border-color: #b5b5b5; }
    .protocol-icon.jupiter { background: #111727; border-color: #16c4e4; }

    /* Activity icon containers */
    .activity-icon {
      width: 32px; height: 32px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-4px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse-dot {
      0%, 100% { box-shadow: 0 0 0 0 rgba(0,234,255,0.4); }
      50% { box-shadow: 0 0 0 5px rgba(0,234,255,0); }
    }

    /* Encrypted grid pattern */
    .encrypt-grid {
      display: inline-grid;
      grid-template-columns: repeat(3, 32px);
      grid-template-rows: repeat(3, 32px);
      opacity: 0.1;
    }
  </style>
  <script src="https://unpkg.com/@solana/web3.js@1.98.0/lib/index.iife.min.js"></script>
  <script src="wallet.js"></script>
  <script src="program.js"></script>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Navigation -->
  <nav class="px-[42px] py-[42px] flex items-center justify-between">
    <div class="flex items-center gap-[42px]">
      <!-- Logo + beta -->
      <div class="flex items-center gap-3">
        <!-- Fold logo SVG -->
        <svg width="90" height="22" viewBox="0 0 90 22.1954" fill="none">
          <!-- Icon (Union shape) -->
          <path d="M14.5537 17.2433C15.6723 19.4618 16.2316 20.571 15.7316 21.3832C15.2315 22.1954 13.9892 22.1954 11.5047 22.1954H9.16237C7.62502 22.1954 6.85635 22.1954 6.23817 21.8141C5.62 21.4328 5.27503 20.7459 4.58511 19.372L1.26764 12.766C0.647827 11.5317 0.337918 10.9146 0.363351 10.2557C0.388785 9.59686 0.745344 9.00546 1.45846 7.82268L2.81207 5.57756C4.22242 3.23834 4.9276 2.06873 5.93414 2.10676C6.94068 2.14479 7.55558 3.36429 8.78537 5.80328L14.5537 17.2433Z" fill="#00EAFF"/>
          <path d="M23.6942 6.66999C23.2368 7.58469 23.0082 8.04205 22.6864 8.39368C22.2593 8.86056 21.7108 9.19955 21.1022 9.37283C20.6438 9.50334 20.1324 9.50334 19.1097 9.50334C17.0644 9.50334 16.0417 9.50334 15.1249 9.24232C13.9077 8.89577 12.8107 8.21779 11.9564 7.28403C11.3129 6.58076 10.8478 5.65058 9.91764 3.79023C9.33958 2.63412 9.05056 2.05607 9.08153 1.59333C9.11927 1.02936 9.43369 0.52062 9.92124 0.234645C10.3213 0 10.9561 0 12.2257 0H21.5041C23.9804 0 25.2186 0 25.719 0.809737C26.2195 1.61947 25.6657 2.72691 24.5583 4.94177L23.6942 6.66999Z" fill="#00EAFF"/>
          <!-- "fold" text -->
          <path d="M35.9503 5.69291C35.9503 2.60446 38.421 0.133705 41.5095 0.133705H44.4435V3.22215H41.5095C40.1197 3.22215 39.0387 4.30311 39.0387 5.69291V7.23713H44.4435V10.3256H39.0387V22.0617H35.9503V10.3256H31.7809V7.23713H35.9503V5.69291Z" fill="white"/>
          <path d="M51.6586 22.0617C48.5702 22.0617 46.0994 19.6218 46.0994 16.5334V11.8698C46.0994 8.78136 48.5702 6.3106 51.6586 6.3106H54.1294C57.2178 6.3106 59.6886 8.78136 59.6886 11.8698V16.5334C59.6886 19.6218 57.2178 22.0617 54.1294 22.0617H51.6586ZM49.1879 16.5334C49.1879 17.9232 50.2688 18.9423 51.6586 18.9732H54.1294C55.5192 18.9732 56.6001 17.9232 56.6001 16.5334V11.8698C56.6001 10.48 55.5192 9.39904 54.1294 9.39904H51.6586C50.2688 9.39904 49.1879 10.48 49.1879 11.8698V16.5334Z" fill="white"/>
          <path d="M61.4015 22.0617V18.9732H66.4974V3.22215H61.4015V0.133705H69.5859V18.9732H74.9906V22.0617H61.4015Z" fill="white"/>
          <path d="M81.97 22.0617C78.9125 22.0617 76.4108 19.56 76.4108 16.5025V11.8698C76.4108 8.78136 78.9125 6.3106 81.97 6.3106H84.3481L86.9116 8.04013V0.133705H90V22.0617H86.9116V20.3321L84.3481 22.0617H81.97ZM79.4993 16.5025C79.4993 17.8614 80.6111 18.9732 81.97 18.9732H83.3907L86.9116 16.5951V11.7771L83.3907 9.39904H81.97C80.6111 9.39904 79.4993 10.5109 79.4993 11.8698V16.5025Z" fill="white"/>
        </svg>
        <div class="flex items-center justify-center px-3 py-1.5 rounded-md" style="background:rgba(255,255,255,0.1);">
          <span style="font-size:15px;font-weight:500;color:rgba(255,255,255,0.5);">beta</span>
        </div>
      </div>
      <!-- Nav links -->
      <div class="flex items-center">
        <a href="index.html" class="px-6 py-3 text-[15px] font-medium text-white">Dashboard</a>
        <a href="activity.html" class="px-6 py-3 text-[15px] font-medium" style="color:rgba(255,255,255,0.6);">Activity</a>
        <a href="alerts.html" class="px-6 py-3 text-[15px] font-medium" style="color:rgba(255,255,255,0.6);">Alerts</a>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <!-- Settings icon -->
      <a href="settings.html" style="color:rgba(255,255,255,0.5);">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
        </svg>
      </a>
      <!-- Connect button -->
      <button id="connect-btn" class="px-6 py-3 rounded-xl text-[15px] font-medium cursor-pointer transition-all" style="background:rgba(43,174,218,0.1);color:#00EAFF;border:none;" onmouseover="this.style.background='rgba(43,174,218,0.2)'" onmouseout="this.style.background='rgba(43,174,218,0.1)'">
        <span id="nav-wallet-addr">Connect</span>
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="flex-1 px-[42px]">

    <!-- Positions Shield Status -->
    <div class="shield-card p-6 mb-2" style="position:relative;overflow:hidden;">
      <!-- Gradient glow polygon (right side) -->
      <div style="position:absolute;left:616px;top:-45px;width:1050px;height:1050px;display:flex;align-items:center;justify-content:center;pointer-events:none;">
        <div style="transform:rotate(-63.31deg);">
          <svg width="782" height="782" viewBox="0 0 1690 1599" fill="none" style="filter:blur(253px);opacity:0.15;">
            <path d="M844.816 506.2L1183.43 1092.7H506.2L844.816 506.2Z" fill="#2BAEDA"/>
          </svg>
        </div>
      </div>
      <!-- Gradient glow polygon (left side) -->
      <div style="position:absolute;left:-822px;top:-45px;width:1050px;height:1050px;display:flex;align-items:center;justify-content:center;pointer-events:none;">
        <div style="transform:rotate(-63.31deg);">
          <svg width="782" height="782" viewBox="0 0 1690 1599" fill="none" style="filter:blur(253px);opacity:0.15;">
            <path d="M844.816 506.2L1183.43 1092.7H506.2L844.816 506.2Z" fill="#2BAEDA"/>
          </svg>
        </div>
      </div>
      <!-- Card content -->
      <div style="position:relative;z-index:1;">
        <div class="flex items-start justify-between mb-16">
          <div class="flex flex-col gap-5">
            <h2 class="text-2xl font-medium text-white">Positions Shield Status</h2>
            <div class="flex items-center gap-3 text-[15px]">
              <span style="color:rgba(255,255,255,0.6);">Health over the past 90 days.</span>
              <a href="#" class="flex items-center" style="color:rgba(0,234,255,0.7);text-decoration:none;">
                View historical health.
                <svg width="24" height="24" fill="none" viewBox="0 0 24 24"><path d="M13 7l5 5-5 5M6 7l5 5-5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" opacity="0.7"/></svg>
              </a>
            </div>
          </div>
          <div class="text-right flex flex-col gap-5">
            <div class="text-2xl font-semibold" style="color:#00EAFF;">100%</div>
            <div class="text-[15px]" style="color:rgba(255,255,255,0.6);">Health Factor</div>
          </div>
        </div>
        <!-- 90-day bar chart -->
        <div id="health-chart" class="flex items-center justify-between w-full" style="height:50px;">
          <!-- Bars generated by JS -->
        </div>
      </div>
    </div>

    <!-- Stats Row -->
    <div class="grid grid-cols-4 gap-6 py-8">
      <!-- Risk Checks Today -->
      <div class="fold-card fold-card-glow p-6">
        <div class="flex flex-col gap-5">
          <div id="stat-risk-checks" class="text-2xl font-medium text-white">—</div>
          <div class="text-[15px]" style="color:rgba(255,255,255,0.6);">Risk Checks Today (every 30s)</div>
        </div>
      </div>
      <!-- Threats Blocked -->
      <div class="fold-card fold-card-glow p-6">
        <div class="flex flex-col gap-5">
          <div class="text-2xl font-medium text-white">12</div>
          <div class="text-[15px]" style="color:rgba(255,255,255,0.6);">Threats Blocked</div>
        </div>
      </div>
      <!-- Protected Positions -->
      <div class="fold-card fold-card-glow p-6">
        <div class="flex flex-col gap-5">
          <div id="stat-position-count" class="text-2xl font-medium text-white">3</div>
          <div class="text-[15px]" style="color:rgba(255,255,255,0.6);">Protected Positions</div>
        </div>
      </div>
      <!-- Portfolio Value (Encrypted) -->
      <div class="fold-card fold-card-glow p-6 relative">
        <!-- Encrypted grid pattern -->
        <div class="encrypt-grid absolute top-6 left-6">
          <div class="size-8" style="background:#2BAEDA;"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.5);"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.25);"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.5);"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.5);"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.25);"></div>
        </div>
        <div class="encrypt-grid absolute bottom-0 right-0 rotate-180">
          <div class="size-8" style="background:#2BAEDA;"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.5);"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.25);"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.5);"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.5);"></div>
          <div class="size-8" style="background:rgba(43,174,218,0.25);"></div>
        </div>
        <div class="flex flex-col gap-5 relative z-10">
          <div class="flex items-center gap-1 w-full">
            <span class="text-2xl font-medium text-white">Hidden from Agent</span>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M14.167 8.333V6.667a4.167 4.167 0 00-8.334 0v1.666m2.084 4.584v1.25m4.166-1.25v1.25M5 8.333h10c.92 0 1.667.746 1.667 1.667v5.833c0 .92-.747 1.667-1.667 1.667H5c-.92 0-1.667-.746-1.667-1.667V10c0-.92.747-1.667 1.667-1.667z" stroke="#00EAFF" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <div class="text-[15px]" style="color:rgba(255,255,255,0.6);">Portfolio Value</div>
        </div>
      </div>
    </div>

    <!-- Two-column layout: Positions + Recent Activity -->
    <div class="flex gap-6 mb-6">

      <!-- Positions Section (left) -->
      <div class="flex-1 min-w-0">
        <!-- Section header -->
        <div class="px-6 mb-[42px]">
          <h2 class="text-2xl font-medium text-white mb-5">Protected Positions</h2>
          <p class="text-[15px]" style="color:rgba(255,255,255,0.6);">Fold is actively monitoring your portfolio via encrypted computation</p>
        </div>

        <!-- Filters & Actions row -->
        <div class="flex items-center justify-between pl-6 mb-[42px]">
          <div class="flex items-center gap-3" id="filter-pills">
            <button class="filter-pill active" data-filter="all">All</button>
            <button class="filter-pill" data-filter="healthy">Healthy (3)</button>
            <button class="filter-pill" data-filter="caution">Caution (1)</button>
            <button class="filter-pill" data-filter="critical">Critical (0)</button>
          </div>
          <div class="flex items-center gap-3 pl-6">
            <button class="flex items-center gap-2.5 p-3 rounded-xl text-[15px] font-medium cursor-pointer border-none" style="background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.5);">
              <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity:0.5;"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              Force Refresh
            </button>
            <button class="flex items-center gap-2.5 p-3 rounded-xl text-[15px] font-medium cursor-pointer border-none" style="background:rgba(43,174,218,0.1);color:#00EAFF;">
              <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
              Add Position
            </button>
          </div>
        </div>

        <!-- Table Header -->
        <div style="background:rgba(255,255,255,0.05);border-radius:24px;">
          <div class="flex items-center gap-3 pl-6 pr-[128px] py-6">
            <div class="w-[297px] text-[15px] font-normal" style="color:rgba(255,255,255,0.5);">Positions</div>
            <div class="w-[200px] px-3 text-[15px] font-normal" style="color:rgba(255,255,255,0.5);">Health</div>
            <div class="w-[187px] px-3 text-[15px] font-normal" style="color:rgba(255,255,255,0.5);">Last Check</div>
            <div class="px-3 text-[15px] font-normal text-center" style="color:rgba(255,255,255,0.5);">Protection</div>
          </div>
        </div>

        <!-- Position Rows -->
        <div id="positions-list" class="mt-2" style="background:rgba(255,255,255,0.03);border-radius:24px;padding:24px 12px;">
          <!-- Row 1: Kamino - Healthy -->
          <div class="position-row" data-health="healthy">
            <div class="flex items-center gap-3 p-3">
              <div class="flex items-center gap-6 w-[297px] h-[52px]">
                <div class="protocol-icon kamino">
                  <svg width="32" height="32" viewBox="0 0 32 32" fill="none"><path d="M16 8L8 12v8l8 4 8-4v-8l-8-4z" fill="#C9F2FA"/><path d="M16 8v16M8 12l16 8M24 12L8 20" stroke="#C9F2FA" stroke-width="0.5"/></svg>
                </div>
                <div class="flex flex-col justify-between h-full py-1.5">
                  <div class="text-[20px] font-medium text-white">Lending Position 1</div>
                  <div class="text-[15px] font-medium" style="color:rgba(255,255,255,0.5);">Kamino</div>
                </div>
              </div>
              <div class="w-[200px]"><span class="badge-healthy">Healthy</span></div>
              <div class="w-[200px]"><span class="badge-healthy" style="background:transparent;color:rgba(255,255,255,0.7);">15s ago</span></div>
              <div class="flex-1"><span class="badge-healthy" style="background:transparent;color:#00EAFF;">Auto-Protect</span></div>
              <div class="flex items-center">
                <button class="action-btn" title="Pause"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 6v12M15 6v12"/></svg></button>
                <button class="action-btn" title="Refresh"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg></button>
                <button class="action-btn" title="Remove"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
              </div>
            </div>
          </div>

          <!-- Row 2: MarginFi - Caution -->
          <div class="position-row" data-health="caution">
            <div class="flex items-center gap-3 p-3">
              <div class="flex items-center gap-6 w-[297px] h-[52px]">
                <div class="protocol-icon marginfi">
                  <svg width="32" height="32" viewBox="0 0 32 32" fill="none"><path d="M16 6L6 26h20L16 6z" fill="#B5B5B5" opacity="0.5"/><path d="M16 12v8M16 22h.01" stroke="#B5B5B5" stroke-width="1.5"/></svg>
                </div>
                <div class="flex flex-col justify-between h-full py-1.5">
                  <div class="text-[20px] font-medium text-white">Lending Position 2</div>
                  <div class="text-[15px] font-medium" style="color:rgba(255,255,255,0.5);">MarginFi</div>
                </div>
              </div>
              <div class="w-[200px]"><span class="badge-caution">Caution</span></div>
              <div class="w-[200px]"><span class="badge-caution" style="background:transparent;color:rgba(255,255,255,0.7);">10s ago</span></div>
              <div class="flex-1"><span class="badge-caution" style="background:transparent;color:#00EAFF;">Auto-Protect</span></div>
              <div class="flex items-center">
                <button class="action-btn" title="Pause"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 6v12M15 6v12"/></svg></button>
                <button class="action-btn" title="Refresh"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg></button>
                <button class="action-btn" title="Remove"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
              </div>
            </div>
          </div>

          <!-- Row 3: Jupiter - At Risk -->
          <div class="position-row" data-health="critical" style="background:rgba(255,255,255,0.05);border-radius:12px;">
            <div class="flex items-center gap-3 p-3">
              <div class="flex items-center gap-6 w-[297px] h-[52px]">
                <div class="protocol-icon jupiter">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <path d="M9.35 2.96L2.97 13.92" stroke="url(#jg1)" stroke-width="1"/>
                    <path d="M4.68 2.96L11.06 13.92" stroke="url(#jg1)" stroke-width="1"/>
                    <path d="M7.02 0.5v13.5" stroke="url(#jg1)" stroke-width="1"/>
                    <defs><linearGradient id="jg1" x1="9.35" y1="2.96" x2="2.97" y2="13.92"><stop stop-color="#C7F284"/><stop offset="1" stop-color="#00BEF0"/></linearGradient></defs>
                  </svg>
                </div>
                <div class="flex flex-col justify-between h-full py-1.5">
                  <div class="text-[20px] font-medium text-white">LP Position 1</div>
                  <div class="text-[15px] font-medium" style="color:rgba(255,255,255,0.5);">Jupiter</div>
                </div>
              </div>
              <div class="w-[200px]"><span class="badge-risk">At Risk</span></div>
              <div class="w-[200px]"><span class="badge-risk" style="background:transparent;color:rgba(255,255,255,0.7);">6s ago</span></div>
              <div class="flex-1"><span class="badge-risk" style="background:transparent;color:#00EAFF;">Auto-Protect</span></div>
              <div class="flex items-center">
                <button class="action-btn" style="background:rgba(255,255,255,0.05);" title="Pause"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 6v12M15 6v12"/></svg></button>
                <button class="action-btn" title="Refresh"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg></button>
                <button class="action-btn" style="background:rgba(255,62,143,0.1);" title="Remove"><svg width="24" height="24" fill="none" stroke="#FF3E8F" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity Sidebar (right) -->
      <div class="flex-1 min-w-0">
        <div style="background:rgba(255,255,255,0.03);border-radius:24px;" class="p-6 h-full">
          <!-- Header -->
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-medium text-white">Recent Activity</h3>
            <a href="activity.html" class="text-[15px] font-medium" style="color:rgba(255,255,255,0.5);text-decoration:none;">View All</a>
          </div>

          <!-- Activity items -->
          <div class="flex flex-col gap-4">
            <!-- 1. Health check passed -->
            <div class="flex items-center gap-3">
              <div class="activity-icon" style="background:rgba(0,234,255,0.1);">
                <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#00EAFF" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-[15px] font-medium text-white">Health check passed</div>
                <div class="text-[12px]" style="color:rgba(255,255,255,0.5);">All positions within safe parameters</div>
              </div>
              <div class="text-[12px] flex-shrink-0" style="color:rgba(255,255,255,0.5);">2m ago</div>
            </div>

            <!-- 2. Position encrypted -->
            <div class="flex items-center gap-3">
              <div class="activity-icon" style="background:rgba(126,90,255,0.1);">
                <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#7E5AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-[15px] font-medium text-white">Position encrypted</div>
                <div class="text-[12px]" style="color:rgba(255,255,255,0.5);">Lending Position 1 data secured via MPC</div>
              </div>
              <div class="text-[12px] flex-shrink-0" style="color:rgba(255,255,255,0.5);">5m ago</div>
            </div>

            <!-- 3. Oracle Volatility Detected (yellow) -->
            <div class="flex items-center gap-3">
              <div class="activity-icon" style="background:rgba(251,251,153,0.1);">
                <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#FBFB99" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-[15px] font-medium text-white">Oracle Volatility Detected</div>
                <div class="text-[12px]" style="color:rgba(255,255,255,0.5);">SOL/USD price deviation exceeded 2%</div>
              </div>
              <div class="text-[12px] flex-shrink-0" style="color:rgba(255,255,255,0.5);">12m ago</div>
            </div>

            <!-- 4. Oracle Volatility Detected (pink/skull) -->
            <div class="flex items-center gap-3">
              <div class="activity-icon" style="background:rgba(255,62,143,0.1);">
                <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#FF3E8F" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="10" r="8"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/><path d="M8 18v4M16 18v4M12 18v4"/></svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-[15px] font-medium text-white">Oracle Volatility Detected</div>
                <div class="text-[12px]" style="color:rgba(255,255,255,0.5);">Critical price movement on JUP/SOL pair</div>
              </div>
              <div class="text-[12px] flex-shrink-0" style="color:rgba(255,255,255,0.5);">18m ago</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Footer Bar -->
  <footer class="footer-bar px-[42px] py-6 mt-auto">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="flex items-center pr-3">
          <span class="px-3 py-1.5 text-[15px] font-medium" style="color:rgba(255,255,255,0.5);">built on</span>
          <svg width="106" height="16" viewBox="0 0 17.521 15.7524" fill="none">
            <path d="M17.521 12.4198L14.6134 15.5374C14.5505 15.6052 14.4743 15.6592 14.3896 15.6962C14.3049 15.7332 14.2135 15.7523 14.1211 15.7524H0.337828C0.27209 15.7524 0.207788 15.7332 0.152796 15.6971C0.0978052 15.6611 0.0545126 15.6098 0.0282177 15.5496C0.00192282 15.4893-0.00623229 15.4227 0.00475167 15.3579C0.0157356 15.2931 0.0453795 15.2329 0.0900571 15.1846L2.99439 12.067C3.05729 11.9993 3.13344 11.9452 3.21814 11.9083C3.30283 11.8713 3.39424 11.8521 3.48665 11.852H17.2699C17.3362 11.8507 17.4015 11.869 17.4575 11.9046C17.5134 11.9402 17.5577 11.9916 17.5845 12.0523C17.6114 12.113 17.6196 12.1803 17.6083 12.2457C17.597 12.3111 17.5666 12.3716 17.521 12.4198ZM14.6134 6.14019C14.5502 6.07278 14.474 6.01896 14.3894 5.98199C14.3048 5.94504 14.2135 5.92573 14.1211 5.92525H0.337828C0.27209 5.92528 0.207788 5.94448 0.152796 5.98051C0.0978052 6.01653 0.0545126 6.06781 0.0282177 6.12806C0.00192282 6.18831-0.00623229 6.25492 0.00475167 6.31973C0.0157356 6.38455 0.0453795 6.44477 0.0900571 6.49299L2.99439 9.61228C3.05752 9.67969 3.13373 9.73351 3.21837 9.77047C3.30301 9.80743 3.3943 9.82674 3.48665 9.82722H17.2699C17.3356 9.82687 17.3996 9.80743 17.4544 9.77129C17.5092 9.73515 17.5522 9.68385 17.5783 9.62367C17.6043 9.56348 17.6124 9.49699 17.6012 9.43232C17.5902 9.36766 17.5607 9.3076 17.5161 9.25949L14.6134 6.14019ZM0.337828 3.9004H14.1211C14.2135 3.90032 14.3049 3.88117 14.3896 3.84419C14.4743 3.80722 14.5505 3.75317 14.6134 3.68545L17.521 0.567812C17.5666 0.519656 17.597 0.459073 17.6083 0.393686C17.6196 0.328299 17.6114 0.261029 17.5845 0.20034C17.5577 0.139651 17.5134 0.0882551 17.4575 0.0526199C17.4015 0.0169845 17.3362-0.0012984 17.2699 7.17391e-05H3.48665C3.39424 0.000169016 3.30283 0.0193057 3.21814 0.0562885C3.13344 0.0932712 3.05729 0.147307 2.99439 0.215025L0.0900571 3.33266C0.0453795 3.38089 0.0157356 3.44111 0.00475167 3.50592C-0.00623229 3.57074 0.00192282 3.63734 0.0282177 3.69759C0.0545126 3.75785 0.0978052 3.80912 0.152796 3.84514C0.207788 3.88117 0.27209 3.90037 0.337828 3.9004Z" fill="white"/>
          </svg>
        </div>
        <div style="width:2px;height:20px;background:rgba(217,217,217,0.2);"></div>
        <div class="flex items-center pr-3">
          <span class="px-3 py-1.5 text-[15px] font-medium" style="color:rgba(255,255,255,0.5);">powered by</span>
          <svg width="98" height="16" viewBox="0 0 98 16.3803" fill="none">
            <path d="M16.0998 1.29411C15.3067-0.208538 13.011 0.0478661 13.011 0.0478661C13.4761 0.453342 13.6192 0.834967 13.8935 1.33585L20.2321 14.4184H18.8964L12.6473 1.50281C11.6276-0.458979 8.15126-0.542459 7.20316 1.50281L0 16.3802H2.21819L8.82507 2.66557C9.27228 1.74729 10.5722 1.78903 10.9836 2.64172L17.6263 16.3802H23.4043L16.0998 1.29411Z" fill="white"/>
            <path d="M9.65987 3.5899L3.53599 16.3803H5.76015L10.9956 5.35491L10.1309 3.57797C9.86858 3.03535 9.9282 3.04727 9.65987 3.5899Z" fill="white"/>
            <g transform="translate(27.99, 3.78)">
              <path d="M40.9191 4.75289V-1.80629C40.9191-1.82417 40.9191-1.8361 40.9131-1.85399V-1.87188V-1.88977C40.9131-1.9971 40.8356-2.0925 40.7342-2.11636C40.7163-2.12232 40.6984-2.12232 40.6805-2.12232C40.609-2.12232 40.5434-2.0925 40.5017-2.03884L40.4897-2.02095L38.1046 3.21446C38.0867 3.25024 38.0688 3.29198 38.0509 3.33372C37.8661 3.75112 37.6097 4.32356 37.234 4.56804C37.0551 4.6873 36.8345 4.74692 36.5662 4.74692C36.2978 4.74692 36.0772 4.6873 35.8983 4.56804C35.5286 4.32356 35.2722 3.75112 35.0814 3.33372C35.0635 3.29198 35.0456 3.25024 35.0277 3.21446L32.6426-2.02095L32.6306-2.03884C32.5889-2.0925 32.5233-2.12232 32.4518-2.12232C32.4339-2.12232 32.416-2.12232 32.3981-2.11636C32.2908-2.0925 32.2192-1.9971 32.2192-1.88977V-1.87188V-1.85399C32.2192-1.8361 32.2132-1.82417 32.2132-1.80629V4.75289H30.5556V-1.80629C30.5556-1.86591 30.5556-1.92554 30.5615-1.98517V-1.99113C30.6092-2.82594 31.2115-3.54148 32.0284-3.7323C32.1655-3.76211 32.3087-3.78 32.4518-3.78C32.4875-3.78 32.5233-3.78 32.5591-3.77404C33.1375-3.74422 33.6801-3.43415 34.0081-2.95712L34.0916-2.8319L36.5662 2.60625L39.0407-2.8319L39.1242-2.95712C39.4522-3.43415 39.9948-3.73826 40.5732-3.77404C40.609-3.77404 40.6448-3.78 40.6805-3.78C40.8237-3.78 40.9608-3.76211 41.1039-3.7323C41.9208-3.54745 42.5231-2.8319 42.5708-1.99113V-1.98517C42.5767-1.93151 42.5767-1.87188 42.5767-1.81225V4.74692H40.9191V4.75289Z" fill="white"/>
            </g>
          </svg>
        </div>
      </div>
      <div class="flex items-center">
        <a href="#" class="px-6 py-3 text-[15px] font-medium" style="color:rgba(255,255,255,0.6);text-decoration:none;">Docs</a>
        <a href="https://github.com/ikeacrisp/fold-defi-agent" class="px-6 py-3 text-[15px] font-medium" style="color:rgba(255,255,255,0.6);text-decoration:none;">Github</a>
        <a href="#" class="px-6 py-3 text-[15px] font-medium" style="color:rgba(255,255,255,0.6);text-decoration:none;">Discord</a>
      </div>
    </div>
  </footer>

  <script>
    const HELIUS_RPC = 'https://devnet.helius-rpc.com/?api-key=10604451-ce29-4041-875d-88322f54ce98';
    const PROGRAM_ID_STR = 'ABDZr3DvUSnugBNrAj8vaAhKt3tHafA82MDja812QbJC';
    const AGENT_WALLET = '7XDzrqLP94yG3n26n8r6VU87gZ98FnF3tQFcm3a4tki7';
    let connection, programId;
    let riskChecksToday = 0;
    let lastSignature = null;

    // ═══ Generate 90-day health bar chart ═══
    (function() {
      const chart = document.getElementById('health-chart');
      for (let i = 0; i < 90; i++) {
        let status = 'healthy';
        // Create some variety: a few caution and risk days
        if (i === 18 || i === 19) status = 'caution';
        else if (i === 42) status = 'caution';
        else if (i >= 86 && i <= 87) { status = i === 86 ? 'caution' : 'risk'; }
        const bar = document.createElement('div');
        bar.className = 'health-bar ' + status;
        bar.style.height = '50px';
        bar.title = (90 - i) + ' days ago: ' + status.charAt(0).toUpperCase() + status.slice(1);
        chart.appendChild(bar);
      }
    })();

    // ═══ Filter pills ═══
    document.querySelectorAll('#filter-pills .filter-pill').forEach(pill => {
      pill.addEventListener('click', function() {
        document.querySelectorAll('#filter-pills .filter-pill').forEach(p => p.classList.remove('active'));
        this.classList.add('active');
        const filter = this.dataset.filter;
        document.querySelectorAll('#positions-list .position-row').forEach(row => {
          if (filter === 'all') row.style.display = '';
          else if (filter === 'healthy') row.style.display = row.dataset.health === 'healthy' ? '' : 'none';
          else if (filter === 'caution') row.style.display = row.dataset.health === 'caution' ? '' : 'none';
          else if (filter === 'critical') row.style.display = row.dataset.health === 'critical' ? '' : 'none';
        });
      });
    });

    // ═══ Tick timers ═══
    setInterval(() => {
      document.querySelectorAll('#positions-list .position-row').forEach(row => {
        const timeEl = row.querySelector('[style*="rgba(255,255,255,0.7)"]');
        if (timeEl) {
          const m = timeEl.textContent.match(/^(\d+)s ago$/);
          if (m) timeEl.textContent = (parseInt(m[1]) + 1) + 's ago';
        }
      });
    }, 1000);

    // ═══ Format relative time ═══
    function timeAgo(ts) {
      const diff = Math.floor(Date.now() / 1000) - ts;
      if (diff < 60) return diff + 's ago';
      if (diff < 3600) return Math.floor(diff / 60) + ' min ago';
      if (diff < 86400) return Math.floor(diff / 3600) + ' hour' + (Math.floor(diff / 3600) > 1 ? 's' : '') + ' ago';
      return Math.floor(diff / 86400) + ' day' + (Math.floor(diff / 86400) > 1 ? 's' : '') + ' ago';
    }

    // ═══ Fetch recent transactions from devnet ═══
    async function fetchRecentTxs() {
      try {
        const sigs = await connection.getSignaturesForAddress(programId, { limit: 25 });
        if (sigs.length === 0) return;
        const todayStart = new Date();
        todayStart.setHours(0, 0, 0, 0);
        const todayTs = Math.floor(todayStart.getTime() / 1000);
        let todayCount = 0;
        for (const sig of sigs) {
          if (sig.blockTime && sig.blockTime >= todayTs) todayCount++;
        }
        riskChecksToday = todayCount;
        document.getElementById('stat-risk-checks').textContent = riskChecksToday;
        lastSignature = sigs[0].signature;
      } catch (e) {
        console.error('Failed to fetch recent txs:', e);
      }
    }

    // ═══ Poll for new transactions ═══
    async function pollNewTxs() {
      try {
        const opts = { limit: 10 };
        if (lastSignature) opts.until = lastSignature;
        const sigs = await connection.getSignaturesForAddress(programId, opts);
        if (sigs.length > 0) {
          lastSignature = sigs[0].signature;
          riskChecksToday += sigs.length;
          document.getElementById('stat-risk-checks').textContent = riskChecksToday;
        }
      } catch (e) {
        console.error('Poll error:', e);
      }
    }

    // ═══ Subscribe to live on-chain events ═══
    function subscribeLiveEvents() {
      try {
        connection.onLogs(programId, (logs) => {
          if (logs.err) return;
          const logStr = logs.logs.join('\n');
          if (logStr.includes('HealthCheckCompleted')) {
            riskChecksToday++;
            document.getElementById('stat-risk-checks').textContent = riskChecksToday;
          }
        }, 'confirmed');
      } catch (e) {
        console.error('WebSocket subscription error:', e);
      }
    }

    // ═══ Init ═══
    (async function() {
      connection = new solanaWeb3.Connection(HELIUS_RPC, { commitment: 'confirmed', wsEndpoint: HELIUS_RPC.replace('https://', 'wss://') });
      programId = new solanaWeb3.PublicKey(PROGRAM_ID_STR);
      try {
        await FoldWallet.init();
        if (FoldWallet.isConnected() && FoldWallet.publicKey) {
          document.getElementById('nav-wallet-addr').textContent = FoldWallet.shortenAddress(FoldWallet.publicKey);
        }
      } catch(e) {
        console.log('Wallet not connected — showing read-only mode');
      }
      await fetchRecentTxs();
      subscribeLiveEvents();
      setInterval(pollNewTxs, 15000);
    })();
  </script>
</body>
</html>
